<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestor Retro de Herramientas y Assets</title>
  <style>
    body {
      background-color: black;
      color: #00FF00;
      font-family: 'Courier New', monospace;
      padding: 20px;
    }
    input, button {
      background-color: black;
      color: #00FF00;
      border: 1px solid #00FF00;
      padding: 5px;
      margin: 5px;
    }
    button:hover {
      background-color: #00FF00;
      color: black;
    }
    h1, h2 {
      border-bottom: 1px solid #00FF00;
    }
    ul {
      list-style: square;
    }
  </style>
</head>
<body>
  <h1>🕹️ Gestor Retro</h1>

  <!-- Herramientas -->
  <section>
    <h2>🛠️ Herramientas</h2>
    <form id="form-herramienta">
      <input name="id" placeholder="ID (actualizar)" type="number" />
      <input name="nombre" placeholder="Nombre" required />
      <input name="version" placeholder="Versión" required />
      <input name="licencia" placeholder="Licencia" required />
      <button type="submit">Guardar</button>
    </form>
    <input id="buscar-herramienta" placeholder="Buscar por nombre" />
    <button onclick="buscarHerramienta()">🔍 Buscar</button>
    <input id="filtrar-licencia" placeholder="Filtrar por licencia" />
    <button onclick="filtrarPorLicencia()">📄 Filtrar</button>
    <ul id="lista-herramientas"></ul>
  </section>

  <!-- Assets -->
  <section>
    <h2>🎨 Assets</h2>
    <form id="form-asset">
      <input name="id" placeholder="ID (actualizar)" type="number" />
      <input name="nombre" placeholder="Nombre" required />
      <input name="tipo" placeholder="Tipo" required />
      <input name="autor" placeholder="Autor" required />
      <input name="anio" placeholder="Año" type="number" required />
      <button type="submit">Guardar</button>
    </form>
    <input id="buscar-asset" placeholder="Buscar por nombre" />
    <button onclick="buscarAsset()">🔍 Buscar</button>
    <input id="filtrar-tipo" placeholder="Filtrar por tipo" />
    <button onclick="filtrarPorTipo()">🧩 Filtrar</button>
    <ul id="lista-assets"></ul>
  </section>

  <script>
    const API = "https://dev-proyectointegrador2.onrender.com";

    // Herramientas
    async function cargarHerramientas() {
      const res = await fetch(`${API}/herramientas`);
      const data = await res.json();
      const lista = document.getElementById("lista-herramientas");
      lista.innerHTML = "";
      data.forEach(h => {
        const li = document.createElement("li");
        li.textContent = `${h.id}: ${h.nombre} v${h.version} (${h.licencia})`;
        const btn = document.createElement("button");
        btn.textContent = "❌";
        btn.onclick = async () => {
          await fetch(`${API}/herramientas/${h.id}`, { method: "DELETE" });
          cargarHerramientas();
        };
        li.appendChild(btn);
        lista.appendChild(li);
      });
    }

    document.getElementById("form-herramienta").addEventListener("submit", async e => {
      e.preventDefault();
      const f = e.target;
      const body = {
        id: f.id.value ? parseInt(f.id.value) : undefined,
        nombre: f.nombre.value,
        version: f.version.value,
        licencia: f.licencia.value,
        activo: true
      };
      await fetch(`${API}/herramientas`, {
        method: body.id ? "PUT" : "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      f.reset();
      cargarHerramientas();
    });

    async function buscarHerramienta() {
      const nombre = document.getElementById("buscar-herramienta").value;
      const res = await fetch(`${API}/herramientas/buscar/${nombre}`);
      const data = await res.json();
      const lista = document.getElementById("lista-herramientas");
      lista.innerHTML = "";
      data.forEach(h => {
        const li = document.createElement("li");
        li.textContent = `${h.id}: ${h.nombre} v${h.version} (${h.licencia})`;
        lista.appendChild(li);
      });
    }

    async function filtrarPorLicencia() {
      const licencia = document.getElementById("filtrar-licencia").value;
      const res = await fetch(`${API}/herramientas/licencia/${licencia}`);
      const data = await res.json();
      const lista = document.getElementById("lista-herramientas");
      lista.innerHTML = "";
      data.forEach(h => {
        const li = document.createElement("li");
        li.textContent = `${h.id}: ${h.nombre} v${h.version} (${h.licencia})`;
        lista.appendChild(li);
      });
    }

    // Assets
    async function cargarAssets() {
      const res = await fetch(`${API}/assets`);
      const data = await res.json();
      const lista = document.getElementById("lista-assets");
      lista.innerHTML = "";
      data.forEach(a => {
        const li = document.createElement("li");
        li.textContent = `${a.id}: ${a.nombre} (${a.tipo}) - ${a.autor} [${a.anio}]`;
        const eliminar = document.createElement("button");
        eliminar.textContent = "❌";
        eliminar.onclick = async () => {
          await fetch(`${API}/assets/${a.id}`, { method: 'DELETE' });
          cargarAssets();
        };
        li.appendChild(eliminar);
        lista.appendChild(li);
      });
    }

    document.getElementById('form-asset').addEventListener('submit', async e => {
      e.preventDefault();
      const f = e.target;
      const body = {
        id: f.id.value ? parseInt(f.id.value) : undefined,
        nombre: f.nombre.value,
        tipo: f.tipo.value,
        autor: f.autor.value,
        anio: parseInt(f.anio.value),
        activo: true
      };
      await fetch(`${API}/assets`, {
        method: body.id ? 'PUT' : 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      f.reset();
      cargarAssets();
    });

    async function buscarAsset() {
      const nombre = document.getElementById('buscar-asset').value;
      const res = await fetch(`${API}/assets/buscar/${nombre}`);
      const data = await res.json();
      const lista = document.getElementById('lista-assets');
      lista.innerHTML = '';
      data.forEach(a => {
        const li = document.createElement('li');
        li.textContent = `${a.id}: ${a.nombre} (${a.tipo}) - ${a.autor} [${a.anio}]`;
        lista.appendChild(li);
      });
    }

    async function filtrarPorTipo() {
      const tipo = document.getElementById('filtrar-tipo').value;
      const res = await fetch(`${API}/assets/tipo/${tipo}`);
      const data = await res.json();
      const lista = document.getElementById('lista-assets');
      lista.innerHTML = '';
      data.forEach(a => {
        const li = document.createElement('li');
        li.textContent = `${a.id}: ${a.nombre} (${a.tipo}) - ${a.autor} [${a.anio}]`;
        lista.appendChild(li);
      });
    }

    cargarHerramientas();
    cargarAssets();
  </script>
</body>
</html>
